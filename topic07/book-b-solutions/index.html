 <!DOCTYPE html>
 <html>
   <head>
     <meta charset="utf-8" />
     <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
   
     <title> Lab-07-B-Solutions </title>
   
     <link href='https://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>
     <link rel="stylesheet" href="./style/semantic/css/semantic.min.css" type="text/css">  
     <link rel="stylesheet" href="./style/custom/main.css" type="text/css"> 
   
     <script src="./style/custom/jquery-2.1.0.min.js"></script> 
     <script src="./style/custom/jquery.address-1.6.min.js"></script>
     <script src="./style/semantic/javascript/semantic.min.js"></script>
   
     <link rel="stylesheet" href="./style/highlight/school_book.css">
     <script src="./style/highlight/highlight.pack.js"></script> 
     <script>hljs.initHighlightingOnLoad();</script>
   
     <script src="./style/custom/common.js"> </script> 
     <script src="./style/custom/main.js"> </script> 
  </head>
  <body>
  <nav class="ui fixed top pointing borderless inverted menu">
    <header class="header item"> <a href="../index.html">Designing classes (Spacebook)</a></header>
    <div class="right tab-menu menu">
          <a class="item" data-tab="Lab-07-B-Solutions"> Lab-07-B-Solutions </a>
          <a class="item" data-tab="01"> 01 </a>
          <a class="item" data-tab="02"> 02 </a>
          <a class="item" data-tab="03"> 03 </a>
          <a class="item" data-tab="04"> 04 </a>
          <a class="item" data-tab="05"> 05 </a>
          <a class="item" data-tab="06"> 06 </a>
    </div>
  </nav>

  <br>

	  <section data-tab="Lab-07-B-Solutions" class="ui tab stacked moodle-book segment">
	     <h1>Objectives</h1>
<p>Solutions to exercises in Spacebook Application (Part 2)</p>
	  </section>
	  <section data-tab="01" class="ui tab stacked moodle-book segment">
	     <h1>Exercises</h1>
<h2>Exercise 1</h2>
<ul>
<li>Create 5 User objects on the object bench:<ul>
<li>Select names, email address and password of your choice for each.</li>
<li>Here is a sample constructor invocation that conforms to the User constructor signature and that uses very simple strings :<ul>
<li>User("a", "b", "c", "d")</li>
</ul>
</li>
<li>Tablulate on paper the friendship relationships depicted in Figure 1.</li>
<li>Use the object bench to represent the friendship relationships .</li>
<li>Verify correct implementation of the friendship network using existing User class method(s)
<img alt="Figure 1: User - Friendship network" src="img/09.png"></li>
</ul>
</li>
</ul>
<h2>Exercise 1 Solution</h2>
<ul>
<li>
<p>You could manually create the 5 User objects by clicking on the User class diagram and invoking the User constructor for each object (see Figure 2)
<img alt="Figure 2: Manually create User object" src="img/01.png"></p>
</li>
<li>
<p>An alternative and possibly quicker method would be to use the UserTest class as follows:</p>
<ul>
<li>Open UserTest in editor</li>
<li>Add and simulaneously initialize 5 User fields (see Figure 3)
<img alt="Figure 3 Availing of UserTest to generate User objects" src="img/02.png"></li>
<li>Compile UserTest</li>
<li>Invoke <em>Test Fixture to Object Bench</em> on UserText<ul>
<li>This will position the 5 User objects on the object bench
<img alt="Figure 4: Using Text Fixture to Object Bench" src="img/03.png"></li>
</ul>
</li>
</ul>
</li>
<li>
<p>Tabular representation of User-Friendship relationships depicted here in Figure 5. </p>
<ul>
<li>The table may be created by observing the network of relationships portrayed in Figure 1 above.
<img alt="Figure 5: User-Friendship network" src="img/04.png"></li>
</ul>
</li>
<li>
<p>Represent (implement) the friendship relationships using the objects on the object bench:</p>
</li>
<li>Marge first, followed by the others:<ul>
<li>Right click on User marge and invoke <em>befriend</em><ul>
<li>befriend <em>bart</em></li>
</ul>
</li>
<li>Repeat for <em>barney</em> and <em>homer</em> (see Figure 6).
<img alt="Figure 6: Marge creates friendship networkd" src="img/05.png"></li>
<li>Check friends have been created:<ul>
<li>Invoke <em>displayFriends</em> on <em>User marge</em>:</li>
<li>Check the correct list of friends displayed (Figure 7).
<img alt="Figure 7: Marge's friends" src="img/06.png"></li>
</ul>
</li>
</ul>
</li>
<li>Repeat the above steps for Bart, Barney, Homer and Maggie.<ul>
<li>Bart: see Figure 8:
<img alt="Figure 8: Bart's friends" src="img/07.png"></li>
<li>Barney: see Figure 8:
<img alt="Figure 9: Barney's friends" src="img/08.png"></li>
<li>Homer: see Figure 8:
<img alt="Figure 10: Homer's friends" src="img/11.png"></li>
<li>Maggie:  see Figure 8:
<img alt="Figure 11: Maggie's friends" src="img/12.png"></li>
</ul>
</li>
</ul>
	  </section>
	  <section data-tab="02" class="ui tab stacked moodle-book segment">
	     <h1>Exercises</h1>
<h2>Exercise 2</h2>
<p>Recall that it is possible for a user to befriend itself. 
For example, you could </p>
<ul>
<li>create a User object <em>bart</em> and </li>
<li>invoke <em>befriend</em> on <em>bart</em> <ul>
<li>using <em>bart</em> as a parameter</li>
</ul>
</li>
<li>invoking <em>displayFriends</em> on <em>bart</em> will demonstrate he has succeeded in befriending himself (see Figure 2).
<img alt="Figure 2: Bart befriends Bart" src="img/10.png"></li>
<li>This Exercise requires you to modify the method <em>befriend</em> in User to disallow a user befriending oneself.<ul>
<li>Test the refactored method works as intended by invoking it<ul>
<li>Using the invoking object as the argument, that is, attempting to befriend oneself</li>
<li>Using an object other than the invoking object to establish a friendship.</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2>Exercise 2 Solution</h2>
<p>Here is the existing method <em>befriend</em>:</p>
<pre><code>    public void befriend(User friend)
    {
        Friendship friendship = new Friendship(this, friend);
        friendships.add(friendship);
    }
</code></pre>

<p>Here is the same method but refactored to prevent a user befriending oneself:</p>
<pre><code>    public void befriend(User friend)
    {
        if(!(friend == this))
        {
            Friendship friendship = new Friendship(this, friend);
            friendships.add(friendship);
        }
        else
        {
            System.out.println(&quot;Opps! You seem to have made a mistake in attempting to befriend yourself&quot;);
        }
    }
</code></pre>

<h2>Test 1 : Attempt befriending oneself</h2>
<ul>
<li>Remove all friends from <em>marge</em></li>
<li>Invoke <em>befriend</em> on <em>User marge</em> using <em>marge</em> as argument.</li>
<li>This action should fail (see Figure 3).
<img alt="Figure 3: Attempt to befriend oneself no longer permissible" src="img/13.png"></li>
</ul>
<h2>Test 2 : Attempt befriending other user</h2>
<ul>
<li>Ensure that <em>marge</em> has no friends<ul>
<li>if necessary invoke <em>unfriend</em> to remove any that may be present</li>
</ul>
</li>
<li>Invoke <em>befriend</em> on <em>User marge</em> using <em>bart</em> as argument.<ul>
<li>Display <em>marge</em> friends to verify refactored <em>befriend</em> still functions correctly (see Figure 4)
<img alt="Figure 4 Attempt to befriend other user succeeds" src="img/14.png"></li>
</ul>
</li>
</ul>
	  </section>
	  <section data-tab="03" class="ui tab stacked moodle-book segment">
	     <h1>Exercises</h1>
<h2>Exercise 3</h2>
<p>Presently a user can remove a specific friend from its list of <em>friendships</em> by invoking <em>unfriend</em>.</p>
<ul>
<li>Write a method that would allow a user to remove all friends.</li>
<li>Use the signature: <em>public void unfriendAll()</em></li>
</ul>
<h2>Exercise 3 Solution</h2>
<p>Here is a method to remove a user's complete list of friends:</p>
<pre><code>    public void unfriendAll()
    {
        for(int i = friendships.size() - 1; i &gt;= 0; i -= 1)
        {
            friendships.remove(i);
        }
    }
</code></pre>

<p>We iterate using a for loop from the end of the ArrayList of <em>friendships</em>, removing each element in turn until we reach the last element at index zero.</p>
<ul>
<li>See <a href="http://stackoverflow.com/search?q=how+to+remove+all+elements+from+an+ArrayList+stackoverflow">here</a> for a discussion on the technique used.</li>
</ul>
<h2>Test Solution</h2>
<ul>
<li>Invoke <em>Test Fixture to Object Bench</em></li>
<li>As shown in Figure 1, User objects representing marge, bart, barney, homer and maggie will be placed on the object bench.
<img alt="Figure 1" src="img/15.png"></li>
<li>By invoking <em>befriend</em>, create 3 friends for <em>User marge</em> <ul>
<li>bart,</li>
<li>barney &amp;</li>
<li>homer</li>
</ul>
</li>
<li>Invoke <em>displayFriends</em> to verify these friends have been created (see Figure 2):
<img alt="Figure 2: Marge's new old friends" src="img/16.png"></li>
<li>Test the new method <em>unfriendAll</em> by invoking it on <em>User marge</em></li>
<li>Then invoke <em>displayFriends</em> to verify method works as intended (see Figure 3):
<img alt="Figure 3: Test run method unfriendall" src="img/17.png"></li>
</ul>
<p>Why does the loop traverse from <em>size-1</em> to 0 rather then the more usual 0 to <em>size-1</em>?</p>
<ul>
<li>Rewrite the method looping from 0 to less than <em>size</em></li>
<li>Can you explain the odd behaviour?</li>
</ul>
<h2>Exercise 3 Alternative Solution</h2>
<p>Here is an alternative approach using an iterator:</p>
<pre><code>    public void unfriendsAll2()
    {
        Iterator&lt;Friendship&gt; it = friendships.iterator();
        while(it.hasNext())
        {
            it.next();
            it.remove();
        }
    }
</code></pre>

<p>You are recommended to study the Iterator API whose documentation is available online <a href="http://docs.oracle.com/javase/7/docs/api/java/util/Iterator.html">here</a>, in particular the <em>remove</em> method, in order to understand why this method works.</p>
<h2>Test Alternative Solution</h2>
<p>Check that this method, <em>unfriendAll2</em>, behaves similarly to <em>unfriendAll</em>.</p>
<ul>
<li>Use UserTest to populate the object bench as before using <em>UserTest</em> method <em>Test Fixture to Object Bench</em> as shown in Figure 1 above.</li>
<li>Display Marge's friends (as shown in Figure 2). They should be:<ul>
<li>Bart</li>
<li>Barney</li>
<li>Homer</li>
</ul>
</li>
<li>Invoke <em>unfriendAll2</em>.</li>
<li>Display Marge's friends once more.<ul>
<li>The message <em>Unfortunately you have no friends</em> should be displayed (Figure 4).</li>
</ul>
</li>
</ul>
<p><img alt="Figure 4: Test run method unfriendAll2" src="img/31.png"></p>
<h2>Pitfalls</h2>
<p>You may have considered writing the method as follows:</p>
<pre><code>    public void unfriendAll3()
    {
        for(int i = 0; i &lt; friendships.size(); i += 1)
        {
            friendships.remove(i);
        }
    }
</code></pre>

<p>What, you may ask, would the problem be with this approach?</p>
<p>The problem may be understood by considering the situation where, for example, 10 elements are present in the <em>friendships</em> list.</p>
<p>Here is a table that captures the value of <em>i</em> and the corresponding value of <em>friendships.size()</em> at each iteration in the <em>for</em> loop (Figure 5). </p>
<ul>
<li>Remember that as each element is removed from the list of <em>friendships</em>, the value returned by <em>friendships.size()</em> is decremented by 1.</li>
<li>Therefore, the loop terminates while 5 of the original 10 <em>friendships</em> elements are still present in the array which is not what is required.</li>
</ul>
<p><img alt="Figure 5: Table relating to unfriendAll3" src="img/32.png"></p>
<p>You can reproduce this behaviour and print out some debug information by using the following augmented version of <em>unfriendAll3</em> as follows:</p>
<pre><code>    public void unfriendAll3()
    {
        for(int i = 0; i &lt; friendships.size(); i ++)
        {
            System.out.println(&quot;i &quot;+i+&quot; size &quot;+friendships.size());
            friendships.remove(i);
        }
        System.out.println();
        System.out.println(&quot;Number of elements remaining *friendships* list is: &quot;+friendships.size());
        for(int i = 0; i &lt; friendships.size(); i ++)
        {
            Friendship f = friendships.get(i);
            System.out.println(f.sourceUser.firstName + &quot;'s friend is &quot;+f.targetUser.firstName); 
        }
    }
</code></pre>

<p>Add this method to User and test using the same approach as above to populate the object bench with the usual 5 User objects.</p>
<ul>
<li>
<p>Then invoke <em>unfriendAll3()</em> and observe the output as depicted in Figure 6.
<img alt="Figure 6: Testing with augmented unfriendAll3" src="img/34.png"></p>
</li>
<li>
<p>On the other hand the corresponding table for <em>unfriendAll</em> where the loop was defined as:</p>
<ul>
<li><em>for(int i = friendships.size() - 1; i &gt;= 0; i -= 1)</em></li>
</ul>
</li>
</ul>
<p>is shown in Figure 7.</p>
<ul>
<li>This results in removing all the elements from the <em>friendships</em> list as required.</li>
</ul>
<p><img alt="Figure 7: Table relating to unfriendAll" src="img/33.png"></p>
	  </section>
	  <section data-tab="04" class="ui tab stacked moodle-book segment">
	     <h1>Exercises</h1>
<h2>Exercise 4</h2>
<ul>
<li>Introduce additional fields in User as follows:</li>
</ul>
<pre><code>  int    age;
  String nationality;
</code></pre>

<ul>
<li>Modify the overloaded constructor to includes parameters representing these fields.<ul>
<li>Apply this signature:<ul>
<li><em>public User(String firstName, String lastName, int age, String nationality, String email, String password)</em></li>
</ul>
</li>
</ul>
</li>
<li>Initialize the new fields within the constructor.</li>
</ul>
<h2>Exercise 4 Solution</h2>
<p>Here is an extract from User class that contains the additional fields and the new overloaded constructor:</p>
<pre><code>public class User
{
    String firstName;
    String lastName;
    int age;
    String nationality;
    String email;
    String password;

    ArrayList&lt;Friendship&gt; friendships   = new ArrayList&lt;&gt;();
    ArrayList&lt;Message&gt; inbox            = new ArrayList&lt;&gt;();
    ArrayList&lt;Message&gt; outbox           = new ArrayList&lt;&gt;(); 

    public User(String firstName, String lastName, int age, String nationality, String email, String password)
    {
        this.firstName  = firstName;
        this.lastName   = lastName;
        this.age        = age;
        this.nationality= nationality;
        this.email      = email;
        this.password   = password;
    }
    ...
    ...
}
</code></pre>

<h2>Test</h2>
<ul>
<li>Add the new code</li>
<li>Compile the class</li>
<li>Instantiate the class using the new overloaded constructor as depicted in Figure 1.
<img alt="Figure 1: Instantiating User by invoking new overloaded constructor" src="img/18.png"></li>
<li>Inspect the object state using the inspector (see Figure 2).</li>
<li>Verify the state matches the data you input.
<img alt="Figure 2: State of User object created with refactored class" src="img/19.png"></li>
</ul>
	  </section>
	  <section data-tab="05" class="ui tab stacked moodle-book segment">
	     <h1>Exercises</h1>
<h2>Exercise 5</h2>
<ul>
<li>Introduce a method named <em>change</em> to the User class with the following signature:<ul>
<li><em>public void change(String firstName, String lastName, int age, String nationality, String email, String password)</em></li>
<li>Implement the method.</li>
</ul>
</li>
<li>Modify the implementation of the overloaded constructor implemented in an earlier step as follows:<ul>
<li>Do not directly assign the actual parameter values to the instance variables<ul>
<li>Example: <em>this.firstName = firstName;</em></li>
</ul>
</li>
<li>Instead, invoke the <em>change</em> method</li>
<li>Reason: Apply where possible the <em>Do not repeat yourself (DRY)</em> policy.<ul>
<li>We have already discussed DRY in an an earlier session (session03 &amp; lecture 5).</li>
</ul>
</li>
</ul>
</li>
<li>Carry out the following tests:<ul>
<li>Create an instance of User using the new constructor.</li>
<li>Verify the state of the object using the inspector.</li>
<li>Change the object's state using the <em>change</em> method.</li>
<li>Again, verify the object's state is correct.</li>
</ul>
</li>
</ul>
<h2>Exercise 5 Solution</h2>
<p>Here is the code for <em>change</em>:</p>
<pre><code>    public void change(String firstName, String lastName, int age, String nationality, String email, String password)
    {
        this.firstName  = firstName;
        this.lastName   = lastName;
        this.age        = age;
        this.nationality= nationality;
        this.email      = email;
        this.password   = password;        
    }
</code></pre>

<p>Here is the overloaded constructor we added earlier:</p>
<pre><code>    public User(String firstName, String lastName, int age, String nationality, String email, String password)
    {
        this.firstName  = firstName;
        this.lastName   = lastName;
        this.age        = age;
        this.nationality= nationality;
        this.email      = email;
        this.password   = password;
    }
</code></pre>

<p>And here is the refactored version of this same constructor:</p>
<pre><code>    public User(String firstName, String lastName, int age, String nationality, String email, String password)
    {
        change(firstName, lastName, age, nationality, email, password);
    }
</code></pre>

<h2>Tests</h2>
<ul>
<li>Recall the tests to be carried out:<ul>
<li>Create an instance of User using the new constructor.</li>
<li>Verify the state of the object using the inspector.</li>
<li>Change the object's state using the <em>change</em> method.</li>
<li>Again, verify the object's state is correct.</li>
</ul>
</li>
</ul>
<p>Create a User instance in the usual manner</p>
<ul>
<li>Use the overloaded constructor as instructed (see Figure 1)
<img alt="Figure 1: Create User object using most recent constructor" src="img/20.png"></li>
<li>Use the inspector to verify the object's state (see Figure 2)
<img alt="Figure 2: Verify object state using inspector" src="img/21.png"></li>
<li>Invoke <em>change</em> on the object </li>
<li>Make some changes to the object state (see Figure 3 for suggestions)
<img alt="Figure 3: Changing object state" src="img/22.png"></li>
<li>Verify the changes by using the inspector (see Figure 4)
<img alt="Figure 4: Inspect changed state via inspector" src="img/23.png"></li>
</ul>
	  </section>
	  <section data-tab="06" class="ui tab stacked moodle-book segment">
	     <h1>Exercises</h1>
<h2>Exercise 6</h2>
<ul>
<li>Introduce a method to broadcast a message from a particular user to all its friends.<ul>
<li>The signature of the method is:<ul>
<li><em>public void broadcastMessage(String messageText)</em></li>
</ul>
</li>
<li>Test the method as follows:<ul>
<li>Use the UserTest as previously (or othe methods) to populate the object bench with 5 User objects.</li>
<li>The network of friendships established in Exercise 1 should be present.</li>
<li>Marge has befriended Bart, Barney and Homer:<ul>
<li>Marge broadcasts a message</li>
<li>Check Marge's outbox</li>
<li>Check the inbox of the intended recipients.</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2>Exercise 6 Solution</h2>
<p>This Exercise is solved by </p>
<ul>
<li>composing the text of a common message destined for the target group<ul>
<li>this would be done in testing</li>
</ul>
</li>
<li>iterating across all the friendships and in each iteration:<ul>
<li>composing a Message object for each friend<ul>
<li>each message object will contain the same common message</li>
</ul>
</li>
<li>adding the Message objects to the outbox of the sender</li>
<li>adding each Message object to the inbox of the recipient</li>
</ul>
</li>
</ul>
<p>Here is an implementation followed by an explanation:</p>
<pre><code>    public void broadcastMessage(String messageText)
    {
        for(Friendship f : friendships)
        {
            Message message = new Message(this, f.targetUser, messageText);
            outbox.add(message);
            f.targetUser.inbox.add(message);
        }
    }
</code></pre>

<p>The enhanced for loop iterates across all the elements in the ArrayList of Friendships:
<img alt="Figure 1: Enhanced for loop traverses list of friendships" src="img/24.png"></p>
<p>For each iteration in the for loop create a Message object (Figure 2).</p>
<ul>
<li>Study the source for the Message class<ul>
<li>The first parameter, <em>this</em>, is assigned to <em>User from</em> in the Message object.</li>
</ul>
</li>
<li>Study the source for the Friendship class<ul>
<li>The second parameter, <em>f.target</em> refers to <em>User targetUser</em> in the <em>Friendship</em> object <ul>
<li>this is assigned to <em>User to</em> in the Message object.</li>
</ul>
</li>
<li>The third parameter, <em>messageText</em>, is the text of the message</li>
</ul>
</li>
</ul>
<p><img alt="Figure 2: Instantiation of Message" src="img/25.png"></p>
<p>The message object is then added to the outbox (Figure 3)</p>
<p><img alt="Figure 3: Add message to outbox" src="img/26.png"></p>
<p>Finally, the message is added to friend's inbox (Figure 4).</p>
<ul>
<li>Note that we are availing of the fact that <ul>
<li>Message, Friendship and User are in the same package</li>
<li>Thus the instance variables in these classes are directly accessible since the do not have access modifiers<ul>
<li><em>Message</em> field <em>User to</em></li>
<li><em>Friendship</em> field <em>User targetUser</em></li>
</ul>
</li>
<li>Because of this, we have made a decision not to use setter or getter methods.</li>
</ul>
</li>
</ul>
<p><img alt="Figure 4: Add message to inbox of target" src="img/27.png"></p>
<h2>Test</h2>
<ul>
<li>Follow the steps in Exercise 1 to create 5 User objects on the object bench with the same network of friendships as depicted in Figure 1 in Exercise 1.</li>
<li>Marge broadcasts to her friends:
<img alt="Figure 5: Marge broadcasts to friends" src="img/28.png"></li>
<li>Check Marge's outbox and observe the message objects have been added:
<img alt="Figure 6: Messages now in Marge's outbox" src="img/29.png"></li>
<li>Check inbox of targets, namely Bart, Barney and Homer:<ul>
<li>Each should have received Marge's broadcast message</li>
</ul>
</li>
</ul>
<p><img alt="Figure 7: Bart receives broadcast message from Marge" src="img/30.png"></p>
	  </section>
  <br>  
  <div class="ui fixed bottom borderless menu">'
    <div class="ui small item"> 
    <p id="footertext">
    Prepared by  John Fitzgerald (johnjfitzgerald@outlook.com). Except where otherwise noted, this content is licensed under a  
     <a  href="http://creativecommons.org/licenses/by-nc/4.0/" title="External link to http://creativecommons.org/licenses/by-nc/4.0/" 
       target="_blank">Creative Commons Attribution-NonCommercial 4.0 License
     </a>
     </p>
    </div>
  </div>   
    
  </body>
 </html>